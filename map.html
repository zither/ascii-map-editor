<!DOCTYPE html>
<html>
<head>
    <title>ASCII Map with Leaflet</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map { height: 600px; }
        .ascii-char {
            font-size: 12px;
            color: white;
            text-shadow: 1px 1px 2px black;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        // 从本地加载 charDefinitions
        fetch('chars.json')
            .then(response => response.json())
            .then(charDefinitions => {
                // 加载地图数据
                fetch('map.txt')
                    .then(response => response.text())
                    .then(data => {
                        const lines = data.split('\n');
                        const mapData = lines.map(line => line.split(''));

                        const map = L.map('map').setView([0, 0], 1);
                        const canvasRenderer = L.canvas({ padding: 0.5 });
                        const asciiLayer = L.layerGroup().addTo(map);

                        mapData.forEach((row, rowIndex) => {
                            row.forEach((char, colIndex) => {
                                const x = colIndex;
                                const y = rowIndex;

                                const charDef = charDefinitions.find(def => def.char === char);
                                if (charDef) {
                                    const rect = L.rectangle([
                                        [y - 0.5, x - 0.5],
                                        [y + 0.5, x + 0.5]
                                    ], {
                                        color: charDef.color,
                                        fillColor: charDef.color,
                                        fillOpacity: 1,
                                        renderer: canvasRenderer
                                    }).addTo(asciiLayer);

                                    L.marker([y, x], {
                                        icon: L.divIcon({
                                            className: 'ascii-char',
                                            html: char,
                                            iconSize: [10, 10]
                                        })
                                    }).addTo(asciiLayer);
                                }
                            });
                        });

                        map.fitBounds([
                            [0, 0],
                            [mapData.length, mapData[0].length]
                        ]);
                    });
            });
    </script>
</body>
</html>